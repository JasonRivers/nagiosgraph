nagiosgraph Installation
------------------------

File:    $Id: INSTALL,v 1.10 2005/05/09 05:53:45 sauber Exp $
Author:  (c) Soren Dossing, 2004
License: OSI Artistic License
         http://www.opensource.org/licenses/artistic-license.php

Follow instructions below to install and use nagiosgraph.

 - Check required packaged are installed: perl, CGI, nagios and rrdtool

 - Install nagiosgraph.conf, map, insert.pl and show.cgi somewhere, fx
   /usr/local/nagios/nagiosgraph/

 - Edit paths and debug level in nagiosgraph.conf.

 - Check that nagios user can write to rrd dir, and www user can read.

 - Check that nagios and www user can write to log file.

 - In insert.pl and show.cgi edit path to nagiosgraph.conf file.

 - In nagios.cfg set:

     process_performance_data=1
     service_perfdata_command=process-service-perfdata

 - In checkcommands.cfg or misccommands.cfg:

     define command {
       command_name  process-service-perfdata
       command_line  /usr/local/nagios/nagiosgraph/insert.pl "$LASTCHECK$||$HOSTNAME$||$SERVICEDESC$||$OUTPUT$||$PERFDATA$"
     }

   Make sure there is only one definition for process-service-perfdata. If
   the RRDs perl modules are installed, then use insert_fast.pl instead.

   Contributed by Stu: In Nagios2.0 use the following macro names:

     "$LASTSERVICECHECK$||$HOSTNAME$||$SERVICEDESC$||$SERVICEOUTPUT$||$SERVICEPERFDATA$"

 - Put an icon approx. 40x40 in .../share/images/logos/ for nagios to link
   to graphs.

 - In cgi.cfg have:

     xedtemplate_config_file=/usr/local/etc/nagios/serviceextinfo.cfg

 - Edit serviceextinfo.cfg

   Most services can be graphed with no particular configuration like this:

     define serviceextinfo {
       service_description  DNS
       hostgroup       servers
       notes_url       /nagiosgraph/show.cgi?host=$HOSTNAME$&service=$SERVICEDESC$
       icon_image      graph.gif
       icon_image_alt  View graphs
     }

   Instead of hostgroup line a host_name line with all hosts where this
   type of data are being collected.

   Some type of services have data values that have big differences in the
   magnitude. In such cases it's good idea to split up into seperate
   graphs. Here's an example for ntp:

     define serviceextinfo {
       service_description  NTP
       host_name       server01,server02,server03,server04
       notes_url       /nagiosgraph/show.cgi?host=$HOSTNAME$&service=$SERVICEDESC$&db=ntp,jitter,offset&db=ntp,stratum
       icon_image      graph.gif
       icon_image_alt  View graphs
     }

 - Add fx &geom=350x100 to notes_url line for custom sizes of graphs.

 - Add fx &rrdopts=%2Dl%200%20%2Du%20100 (meaning: "-l 0 -u 100") to
   notes_url line for custom Y axis ranges. Any rrdgraph options can be
   specified, but has to be url encoded.

 - Configure Apache to point to show.cgi. For example:

     ScriptAlias /nagiosgraph/ /usr/local/nagios/nagiosgraph/

 - To add new service types, edit the map file. This contains regular
   expression to identify service types, and defines how to store data in 
   rrd files. Use testentry.pl for testing before inserting in map file.

 - Consider security

 - Start Nagios. Increase debug level in nagiosgraph.conf if things don't
   work right away.

 - Keep an eye on the log file. It can grow big. Perhaps rotate it, or
   decrease log level when everything works fine.
